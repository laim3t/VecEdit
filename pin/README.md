# 管脚设置模块文档

## 功能概述

管脚设置模块负责管理向量编辑器中的管脚配置，包括以下功能：

1. 管理全局管脚列表（增删改查）
2. 为特定向量表设置和配置管脚
3. 管理管脚组和管脚类型
4. 保持管脚配置与列显示的同步
5. 动态显示/隐藏向量表中的管脚列

## 使用说明

### 设置向量表管脚

1. 在主界面选择一个向量表
2. 点击"设置向量表"按钮，打开"管脚选择"对话框
3. 勾选或取消勾选管脚，设置管脚类型（In/Out/InOut）
   - 当取消勾选管脚时，该管脚列会立即从向量表中隐藏（逻辑删除），同时相关数据会被清除
   - 当重新勾选已隐藏的管脚时，该管脚列会重新显示在向量表中，但会使用默认值重置数据
4. 点击"确定"按钮，系统将更新该向量表关联的管脚
5. 主界面的向量表视图将刷新，管脚列将根据选择显示

### 管脚全局设置

1. 点击"管脚设置"按钮，打开全局管脚设置对话框
2. 可添加、编辑或删除全局管脚
3. 配置管脚的位索引和工位信息

## 输入/输出规范

### 数据库表结构

- `pin_list` - 全局管脚列表
- `vector_table_pins` - 存储向量表与管脚的关联关系
- `type_options` - 存储管脚类型选项
- `VectorTableColumnConfiguration` - 存储向量表列配置信息，包含IsVisible字段用于控制列的显示/隐藏

### 管脚设置对话框输入/输出

- 输入：向量表ID和名称
- 输出：更新后的向量表管脚配置，包括显示/隐藏状态

## 向量表列配置同步机制

当用户通过"管脚选择"对话框修改与特定向量表关联的管脚时，系统会：

1. 更新 `vector_table_pins` 表中的记录，添加或删除相应的管脚关联
2. 同步更新 `VectorTableColumnConfiguration` 表中的列配置：
   - 添加新管脚对应的列配置
   - 取消勾选的管脚列设置 `IsVisible=0`（逻辑删除）
   - 重新勾选的管脚列设置 `IsVisible=1`（恢复显示）
   - 更新管脚类型等属性

这确保了主界面的向量表视图能够正确反映用户设置的管脚配置。

## 向后兼容性

本模块保持完全向后兼容。对于旧版本创建的向量表，系统会在加载时自动检查并修复列配置，确保管脚列正确显示。

## 版本和变更历史

### 版本 2.5.0 (2025-05-xx)

- 新增：当取消勾选管脚时，管脚列立即从向量表中隐藏（逻辑删除）
- 新增：当重新勾选管脚时，管脚列恢复显示，但数据会重置为默认值
- 优化：改进管脚选择UI交互体验，提供即时反馈
- 增强：添加详细日志记录管脚选择状态变化

### 版本 2.4.2 (2023-12-xx)

- 修复：解决删除管脚后，管脚列仍显示在向量表中的问题
- 完善：增强删除管脚功能，确保删除`VectorTableColumnConfiguration`表中的对应列配置

### 版本 2.4.1 (2023-12-xx)

- 修复：解决在管脚选择对话框中只勾选某些管脚时，所有管脚都会显示在向量表中的问题
- 优化：为管脚处理相关代码添加详细日志，便于追踪管脚选择状态

### 版本 2.4.0 (2023-11-xx)

- 修复：解决在管脚选择对话框中添加管脚后，新管脚列有时不显示的问题
- 增强：添加列配置与管脚选择的自动同步机制
- 改进：优化管脚UI显示，增加管脚类型和数据流显示

### 版本 2.3.0 (2023-10-xx)

- 新增：支持管脚组功能，允许用户创建和管理管脚组
- 新增：支持管脚类型和属性的高级配置

### 版本 2.0.0 (2023-09-xx)

- 初始实现，支持基本的管脚选择和配置功能
