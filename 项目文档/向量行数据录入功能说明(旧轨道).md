# 向量行数据录入功能说明

## 1. 功能概述

向量行数据录入是VecEdit软件中的一个核心功能，用于在向量表中添加新的数据行，支持单行或多行模式的数据录入。该功能通过一个专门的对话框界面，让用户可以方便地输入向量数据，并提供了多种便捷功能，如TimeSet设置、添加到队后或向前插入等操作选项。

## 2. 界面组成

从图中可以看到，向量行数据录入对话框主要包括以下界面元素：

### 2.1 标题栏

- 标题显示为"向量行数据录入 - [表名]"，其中[表名]为当前正在编辑的向量表名称

### 2.2 功能按钮区

- **TimeS设置**按钮：快速打开TimeSet设置对话框

### 2.3 数据表格区

- 表格区域用于编辑要添加的向量行数据
- 表头显示管脚信息，包括管脚名称、通道数量和类型
- 单元格中可输入向量值（如0, 1, L, H, X等）
- 表格右侧有添加行(+)和删除行(×)按钮

### 2.4 信息区域

- **文件中总行数**：显示当前向量表中已有的行数
- **剩余可用行数**：显示系统中还可添加的最大行数（总限制为8388608行）

### 2.5 行参数区域

- **添加到队后**复选框：勾选时，新行将添加到向量表末尾
- **向前插入**输入框：不勾选"添加到队后"时启用，指定插入位置
- **行数**输入框：指定要添加的总行数

### 2.6 设置区域

- **TimeSet**下拉选择框：选择要应用的TimeSet

### 2.7 操作按钮

- **确定**按钮：提交数据并关闭对话框
- **取消**按钮：取消操作并关闭对话框

## 3. 使用流程

### 3.1 基本操作流程

1. 在向量表编辑界面中，点击"添加行"按钮或菜单选项
2. 弹出向量行数据录入对话框
3. 编辑表格中的向量数据
4. 根据需要使用添加行(+)或删除行(×)按钮调整表格行数
5. 设置是添加到队后还是向前插入
6. 设置要添加的总行数（必须是表格行数的整数倍）
7. 选择要使用的TimeSet
8. 点击确定按钮完成添加

### 3.2 TimeSet设置

- 点击对话框上方的"TimeS设置"按钮可以快速打开TimeSet设置对话框
- 在TimeSet设置对话框中可以创建或编辑TimeSet定义
- 修改后的TimeSet会立即可用于当前的向量行数据录入操作

## 4. 核心功能特性

### 4.1 模式复制机制

- 对话框支持定义一组向量模式，然后在添加时按照模式循环重复
- 用户在表格中定义基本模式，然后通过"行数"设置总共要添加的行数
- 系统会自动验证添加的总行数必须是模式行数的整数倍，确保模式完整复制

### 4.2 灵活的插入位置

- 支持添加到向量表末尾（勾选"添加到队后"）
- 支持在指定位置插入（取消勾选"添加到队后"，并设置"向前插入"值）

### 4.3 数据校验

- 系统会验证添加的行数是否超过系统限制
- 确保添加的行数是表格中定义的模式行数的整数倍
- 在提交时显示进度对话框，支持取消操作

## 5. 技术实现

### 5.1 核心实现类

- `DialogManager::showVectorDataDialog()`: 创建并管理向量行数据录入对话框
- `MainWindow::showVectorDataDialog()`: 在主窗口中调用对话框并处理结果
- `VectorDataHandler::insertVectorRows()`: 执行实际的向量行插入操作

### 5.2 数据流程

1. 用户通过界面触发向量行添加操作
2. MainWindow类调用DialogManager创建并显示向量行数据录入对话框
3. 用户在对话框中编辑数据并确认
4. 系统将用户输入的模式数据按照设定的行数进行扩展
5. VectorDataHandler执行数据库操作，将数据写入向量表
6. 操作完成后刷新主界面显示

### 5.3 分页与性能优化

- 系统在处理大量行插入时会显示进度对话框
- 实现了数据库批量插入优化，提高插入效率
- 支持操作取消，避免长时间操作无法中断

## 6. 输入规则详解

### 6.1 向量值输入规则

- **有效字符**：向量数据值仅接受以下有效字符
  - `0`：数字零，表示低电平
  - `1`：数字一，表示高电平
  - `L`：低电平（Low），与0等效
  - `H`：高电平（High），与1等效
  - `X`：不关心（Don't care），默认值
  - `S`：SBC信号
  - `V`：无效信号（Invalid）
  - `M`：中间电平（Mid）
- **自动转换**：小写字符（l, h, x, s, v, m）会自动转换为对应的大写形式
- **单字符限制**：每个单元格仅接受一个字符，超出部分将被忽略
- **默认值处理**：空白单元格将自动填入默认值`X`
- **视觉反馈**：无效输入会被自动替换，并提供视觉反馈
- **居中显示**：所有输入在单元格中居中显示，增强可读性

### 6.2 表格操作规则

- **最小行数**：表格至少需要保持一行数据，不允许删除所有行
- **行添加**：点击添加行(+)按钮在表格底部添加新行，默认值为`X`
- **行删除**：可以选中多行后点击删除行(×)按钮删除
- **选择验证**：删除时需要至少选中一行，否则会提示错误
- **行选择**：点击任意单元格会选中整行，方便批量操作

### 6.3 行数设置规则

- **整数倍原则**：设置的总行数必须是表格模式行数的整数倍
- **系统上限**：总行数不能超过系统上限8388608行
- **视觉提示**：当行数不符合整数倍原则时，会显示红色警告
- **有效范围**：行数必须是大于0的整数
- **验证时机**：在输入过程中和确认提交前都会进行验证

### 6.4 插入位置规则

- **两种模式**：
  - **添加到队后模式**：勾选"添加到队后"复选框，数据将添加到向量表末尾
  - **向前插入模式**：取消勾选"添加到队后"复选框，启用"向前插入"输入框
- **行号规则**：
  - 行号从1开始计数（用户友好的1-based索引）
  - 插入位置不能超过向量表的当前总行数
  - 当指定位置小于1时，系统会自动调整为1
- **界面联动**：模式切换时，相关输入控件会自动启用或禁用

## 7. 注意事项

- 添加的总行数必须是模式行数的整数倍
- 系统总行数上限为8388608行
- 在添加行之前，必须先为向量表引用管脚
- TimeSet必须事先定义，否则无法选择
- 大量行数据添加时可能需要一定处理时间，系统会显示进度指示器并支持取消
